# HTTP/1.1のセマンティクス

HTTPはHTMLを取得するだけのプロトコルから、汎用的に使われるプロトコルへと応用範囲を広げていった

## ファイルダウンロード

HTTPサーバにあるファイルをダウンロードする方法について

### ローカル保存

ダウンロード後にブラウザがファイルをどのように処理するかは、Content-Dispositionヘッダーで決定される

```
Content-Disposition: attachment ==> 保存ダイアログを出してファイルを保存する
Content-Disposition: inline ==> ブラウザ表示
```

### ダウンロード

HTTPには、ダウンロードが中断してしまった時に途中から再開する方法が提供されている

サーバー側がレスポンスにAccept-Range: bytesをヘッダーに付与している場合は分割ダウンロードがサポートされるので、ダウンロード再開を実現できる

分割ダウンロードをクライアントで指定する場合は下記のヘッダーをリクエストに含めて取得したいコンテンツの範囲を指定する

```
Range: bytes=1000-1999
```

Rangeヘッダーに複数範囲ダウンロードすることもできる

```
Range: bytes=500-999,7000-7999
```

分割ダウンロード時にサーバーが返すレスポンスには下記のようなヘッダーが付与される

```
Content-Length: 100
Content-Ranges: 1000-1999/5000
```

Content-Lengthには実際にダウンロードされたバイト数が表示され、Content-Rangesにはダウンロードされたバイト数の状況が表示される

クライアントは、既にダウンロードされていたデータ片をつないで一つのファイルを復元する

ETagのハッシュ値が変更されている場合は、ファイルが変更されているのでダウンロードは最初からになる

## XMLHttpRequest

JavaScriptなどといったブラウザ搭載のプログラミング言語でサーバーとのHTTP通信を行うために、ブラウザに組み込まれたAPI

ページ遷移することなくブラウザ上でデータを送受信できるAjaxの基幹技術

ブラウザ上でヘッダーの送受信、キャッシュの制御、クッキーの送受信など、なんでも出来てしまう強力さゆえに機能が一部制限されている

- アクセスできるブラウザの情報の制限として利用できるクッキーに制限がある
- リクエストを送受信できるドメインに制限がある
- 送信できるメソッドに制限がある
- 利用できるヘッダーに制限がある

## Geo-Location

システムが場所を得る方法は二つある。

- WifiのBSSID
  - クライアントが場所を得る方法
  - 携帯端末のGPS情報とWifiのBSSIDを紐づけている
- IPアドレス
  - サーバーがクライアントの場所を推測する方法
  - インターネットサービスプロバイダが持っているIPアドレスと設置している通信機器の住所を紐づけている

どちらも業者が地道に集めたデータベースを頼りにしている

## X-Powered-By

サーバーがクライアントに送る独自ヘッダー、現在は非推奨

例えばNode.jsのWebアプリケーションフレームワークExpress.jsは `X-Powered-By:Express` をデフォルトで返すが、それにより悪意あるクライアントにサーバーの実装がわれてしまう

## リモートプロシージャコール(RPC)

HTTPでの通信の決まりごと。

RESTが原理原則の集合体(アーキテクチャ)であるのに対しRPCは仕様

- XML-RPC
  - ネットワーク越しのサーバーへXMLで何らかの処理を呼び出し結果をXMLで受け取る
  - クライアントからサーバーへのアクセスにはHTTPのPOSTを用いる
- SOAP
  - XML-RPCをより汎用的に拡張した仕様
  - 汎用性を重視するあまり
- JSON
  - XMLの代わりにJSON形式で通信するRPC

RESTが不特定多数への公開に向いてるのに対し、RPCは自由度が高い代わりにハイコンテキストになりがちで、特定された開発者等への公開やSDKに向いている

例えばマイクロサービスアーキテクチャにおけるバックエンドのサーバー間通信にはRPCが向いている場合が多い
