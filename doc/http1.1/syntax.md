# HTTP/1.1のシンタックス

HTTP1.1で通信内容やブラウザとサーバー間のコミュニケーションのセマンティクスの仕様が固まった

## 通信の高速化

### Keep-Alive

TCP/IP通信の接続を節約する仕組み

接続のオーバーヘッドが減るため、通信時間を大きく節約できる

### パイプライニング

通信を並列処理する仕組み。後にストリームという仕組みが実装される布石となった

## TLS

サーバーを認証し、鍵を交換して通信を行う仕組み。

改ざんなとが行えない安定した通信路ができる。

### 共通鍵(AES)と公開鍵(RSA)

TLSでは共通鍵と公開鍵を使い分けて安全性と通信速度を両立している

一度だけ公開鍵で通信し、その後は共通鍵で通信をする

## PUTメソッドDELETEメソッド

PUTとDELETEメソッドがHTTP1.1から追加されたことで、HTTPでCRUDが表現できるようになった

| HTTP | CRUD | SQL |
| --- | --- | --- |
| GET | Read | select |
| POST | Create | insert |
| PUT | Update | update |
| DELETE | Delete | delete |

## OPTIONS、Trace、CONNECTメソッド

### OPTIONS

OPTIONSはサーバーが受け取ることが可能なメソッド

ほとんどのWebサーバーでは使われてないので、サーバーのレスポンスを確認するための用途として利用される

nginxを起動した後に以下のcurlコマンドを実行して挙動を確認できる

```
curl -X OPTIONS localhost
```

### TRACE

CookieヘッダやAuthorizationヘッダといったリクエストで送った情報をそのまま返してくれる

クロスサイトスクリプティングと合わせてユーザーの情報を盗み取るクロスサイトトレーシングによって現在は非推奨メソッドとなっている

クロスサイトトレーシングは、JavaScriptではアクセスできないHttpOnlyなクッキー情報を盗む手段のこと

### CONNECT

HTTPのプロトコルに、他のプロトコルのパケットをのせる

squidを起動した後に以下のコマンドを実行してyahooのサイトにプロキシ経由でアクセスする

```
curl --proxy http://localhost:3128 -v https://yahoo.com
```

## プロトコルのアップグレード

HTTPからHTTP以外のプロトコルに切り替えることができる様になった

例としてHTTPのコネクション確立時にHTTPからWebSocketへプロトコルの切り替えがある

プロトコルの切り替えには

```
Upgrade
Connection
```

といったヘッダーを含めたリクエストを送る

## バーチャルホストのサポート

一台のサーバーでWebサービスを複数のせる仕組み

例えば、http://example.com/helloというURLにアクセスするとする

1. example.comの部分をみてサーバーのipアドレスを特定する
2. httpといったプロトコル名や明示的に指定したポート番号をみて、サーバーに問い合わせるポート番号を決める
3. 最後にHostヘッダーをみて、対象となるサービスコンテンツを得る

## チャンク

データを一括で送信するのではなく、少しずつ小分けにして送信する方法、ストリーミングダウンロード/アップロードと呼ばれる

ヘッダーに

```
Transfer-Encoding: chunked
```

が設定されているはチャンクが実行される
